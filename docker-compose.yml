web: &web
  build: .
  environment:
    - "DB_HOST=db"
    - "DB_PORT=5432"
    - "DB_PASSWORD=supersecret"
    - "DB_USER=vespapp-web"
    - "DB_NAME=vespapp-web"
  volumes:
    - ".:/opt/app/"
  links:
    - "db"
  ports:
    - "80:8000"

dev:
  <<: *web
  command: ["runserver", "0.0.0.0:8000"]

node: &node
  image: "node:5.8"
  volumes:
    - ".:/opt/app"

db:
  image: "postgres:9.5.1"
  expose:
    - "5432"
  volumes:
    - "/opt/vespapp_web/postgresql:/var/lib/postgresql/data"
  environment:
    - "POSTGRES_PASSWORD=supersecret"
    - "POSTGRES_USER=vespapp-web"
    - "POSTGRES_DB=vespapp-web"
